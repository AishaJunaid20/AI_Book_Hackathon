# Data Model: Website Deployment & Embeddings

## Entities

### BookContent
**Description**: The source text from books that will be processed into embeddings
- **id**: string (unique identifier for the content source)
- **url**: string (source URL of the book content)
- **title**: string (title of the book/chapter)
- **content**: string (raw text content)
- **content_type**: string (HTML, plain text, etc.)
- **created_at**: datetime (when content was retrieved)
- **updated_at**: datetime (when content was last updated)

### ContentChunk
**Description**: A processed chunk of book content that will be converted to embeddings
- **id**: string (unique identifier for the chunk)
- **book_content_id**: string (reference to parent BookContent)
- **text**: string (chunked text content, ~1000 words)
- **chunk_index**: integer (position of chunk in original content)
- **word_count**: integer (number of words in chunk)
- **metadata**: object (additional information like headings, sections)

### Embedding
**Description**: Vector representation of text content generated by Cohere model
- **id**: string (unique identifier for the embedding)
- **chunk_id**: string (reference to parent ContentChunk)
- **vector**: array<float> (the embedding vector values)
- **vector_size**: integer (dimension of the embedding vector)
- **model_name**: string (name of the model used to generate embedding)
- **created_at**: datetime (when embedding was generated)

### QdrantRecord
**Description**: Database entry in Qdrant containing embeddings with metadata
- **id**: string (Qdrant record ID, matches Embedding.id)
- **vector**: array<float> (embedding vector stored in Qdrant)
- **payload**: object (metadata including chunk_id, book_content_id, text snippet)
- **collection_name**: string (name of the Qdrant collection)

### ProcessingJob
**Description**: Track the status of embedding generation jobs
- **id**: string (unique identifier for the job)
- **status**: string (pending, processing, completed, failed)
- **source_url**: string (URL being processed)
- **total_chunks**: integer (number of chunks to process)
- **processed_chunks**: integer (number of chunks completed)
- **created_at**: datetime (when job was created)
- **completed_at**: datetime (when job was completed)
- **error_message**: string (if job failed)

## Relationships

```
BookContent (1) → (N) ContentChunk
ContentChunk (1) → (1) Embedding
Embedding (1) → (1) QdrantRecord
ProcessingJob (1) → (N) ContentChunk (via tracking)
```

## Validation Rules

### BookContent
- URL must be valid and accessible
- Content must not be empty
- Content type must be supported (HTML, plain text)

### ContentChunk
- Text length should be between 100 and 1500 words (approximately)
- Chunk index must be sequential for a given book content
- Must reference a valid BookContent

### Embedding
- Vector size must match the model's output dimension (typically 1024 for Cohere)
- Must reference a valid ContentChunk
- Vector values must be valid floats

### QdrantRecord
- ID must match the corresponding Embedding ID
- Vector size must match collection configuration
- Payload must include required metadata

### ProcessingJob
- Status must be one of the defined values
- Total chunks must be >= processed chunks
- Error message only set when status is 'failed'

## State Transitions

### ProcessingJob States
- `pending` → `processing`: When job starts processing
- `processing` → `completed`: When all chunks are processed successfully
- `processing` → `failed`: When an error occurs during processing